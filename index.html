<!DOCTYPE html>
<html>

<head>
	<title></title>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta http-equiv="Permissions-Policy" content="interest-cohort=()">
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">

	<link rel="icon" type="image/png" href="assets/img/favicon.png">
	<link rel="stylesheet" href="assets/css/main.css">

	<!-- Libs -->
	<script src="dist/js/libs/jszip.min.js"></script>
	<script src="dist/js/libs/md5.min.js"></script>
	<!-- <script src="dist/js/libs/epub.min.js"></script> -->
	<script src="dist/js/libs/epub.custom.js"></script>

	<!-- Reader -->
	<script type="module">
		import { Reader } from "./dist/js/epubreader.js"
		const url = new URL(window.location)
		let path = url.searchParams.get("epubUrl") || url.searchParams.get("bookPath") || "https://s3.amazonaws.com/moby-dick/"
		const isBlob = path && path.startsWith("blob:");

		// Handle blob URLs - decode if needed
		if (isBlob) {
			try {
				const decoded = decodeURIComponent(path);
				if (decoded.startsWith("blob:")) {
					path = decoded;
				}
			} catch (e) {
				console.warn("Failed to decode blob URL, using original:", e);
			}
		}
		
		const lang = url.searchParams.get("lang");
			window.onload = (e) => new Reader(path, {
				openbook: false, // disable opening epub file from local
				bookmarks: false, // disable bookmarks
				annotations: false, // disable annotations
				language: lang || 'en', // 'en' | 'tc' | 'sc'
				search: true, // enable search keywords
				settings: false, // enable settings button in side menu
				toolbarsettings: false, // disable settings button in toolbar
				metadata: false, // enable metadata button in side menu
				maxsearchresults: 100, // maximum number of search results for performance issues
			},{
				openAs: isBlob ? "epub" : undefined, // open as epub since the path is blob url
			})
	</script>
</head>

<body>
</body>

</html>